---
title: "p8105_hw6_jz3036"
output: github_document
author: "Junyuan Zheng (jz3036)"
date: 2018-11-17
---

* Import necessary packages.
```{r import_packages}
library(tidyverse)
```

# Problem 1

```{r data_import_p1, message = FALSE}
data_p1 = 
  read_csv(file='./homicide_data/homicide-data.csv')
```

* Create a city_state variable (e.g. “Baltimore, MD”), and a binary variable indicating whether the homicide is solved.
* Omit cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t report victim race. Also omit Tulsa, AL.
* Modifiy victim_race to have categories white and non-white, with white as the reference category. Be sure that victim_age is numeric.
```{r by_city}
data_p1_city = 
  mutate(data_p1, city_state = paste(city, state, sep = ', '),
                  solved = ifelse(disposition == 
                        'Closed without arrest' | disposition == 'Open/No arrest', 0, 1)) %>%
  filter(., city_state != 'Dallas, TX', city_state != 'Phoenix, AZ',
            city_state != 'Kansas City, MO', city_state != 'Tulsa, AL') %>% 
  mutate(., victim_race_white = ifelse(victim_race == 'White', 'White', 'Non-white'),
            victim_race = fct_relevel(victim_race, "White"),
            victim_age = as.numeric(victim_age))
head(data_p1_city)
```

* For the city of Baltimore, MD, use the glm function to fit a logistic regression with resolved vs unresolved as the outcome and victim age, sex and race (as just defined) as predictors.
* Save the output of glm as an R object; apply the broom::tidy to this object; and obtain the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing black victims to white victims keeping all other variables fixed.
```{r glm_Baltimore}
fit_logistic_Baltimore = 
  filter(data_p1_city, city_state == 'Baltimore, MD') %>% 
  glm(solved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

CI_Baltimore = 
  confint(fit_logistic_Baltimore) %>% 
  broom::tidy(.) %>% 
  rename(., term = .rownames, CI_low = X2.5.., CI_high = X97.5..)

fit_logistic_Baltimore %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         CI_low = estimate - std.error*qt(0.975, 2820),
         CI_high = estimate + std.error*qt(0.975, 2820),
         exp_CI_low = exp(CI_low),
         exp_CI_high = exp(CI_high)) %>%
  select(term, OR, exp_CI_low, exp_CI_high) %>%
  filter(., term == 'victim_raceBlack') %>% 
  knitr::kable(digits = 3)
```


