p8105\_hw6\_jz3036
================
Junyuan Zheng (jz3036)
2018-11-17

-   Import necessary packages.

``` r
library(tidyverse)
```

    ## ── Attaching packages ────────────────────────────────────────────────────────── tidyverse 1.2.1 ──

    ## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
    ## ✔ tibble  1.4.2     ✔ dplyr   0.7.8
    ## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
    ## ✔ readr   1.1.1     ✔ forcats 0.3.0

    ## ── Conflicts ───────────────────────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

Problem 1
=========

``` r
data_p1 = 
  read_csv(file='./homicide_data/homicide-data.csv')
```

-   Create a city\_state variable (e.g. “Baltimore, MD”), and a binary variable indicating whether the homicide is solved.
-   Omit cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t report victim race. Also omit Tulsa, AL.
-   Modifiy victim\_race to have categories white and non-white, with white as the reference category. Be sure that victim\_age is numeric.

``` r
data_p1_city = 
  mutate(data_p1, city_state = paste(city, state, sep = ', '),
                  solved = ifelse(disposition == 
                        'Closed without arrest' | disposition == 'Open/No arrest', 0, 1)) %>%
  filter(., city_state != 'Dallas, TX', city_state != 'Phoenix, AZ',
            city_state != 'Kansas City, MO', city_state != 'Tulsa, AL') %>% 
  mutate(., victim_race_white = ifelse(victim_race == 'White', 'White', 'Non-white'),
            victim_race = fct_relevel(victim_race, "White"),
            victim_age = as.numeric(victim_age))
```

    ## Warning in evalq(as.numeric(victim_age), <environment>): NAs introduced by
    ## coercion

``` r
head(data_p1_city)
```

    ## # A tibble: 6 x 15
    ##   uid   reported_date victim_last victim_first victim_race victim_age
    ##   <chr>         <int> <chr>       <chr>        <fct>            <dbl>
    ## 1 Alb-…      20100504 GARCIA      JUAN         Hispanic            78
    ## 2 Alb-…      20100216 MONTOYA     CAMERON      Hispanic            17
    ## 3 Alb-…      20100601 SATTERFIELD VIVIANA      White               15
    ## 4 Alb-…      20100101 MENDIOLA    CARLOS       Hispanic            32
    ## 5 Alb-…      20100102 MULA        VIVIAN       White               72
    ## 6 Alb-…      20100126 BOOK        GERALDINE    White               91
    ## # ... with 9 more variables: victim_sex <chr>, city <chr>, state <chr>,
    ## #   lat <dbl>, lon <dbl>, disposition <chr>, city_state <chr>,
    ## #   solved <dbl>, victim_race_white <chr>

-   For the city of Baltimore, MD, use the glm function to fit a logistic regression with resolved vs unresolved as the outcome and victim age, sex and race (as just defined) as predictors.
-   Save the output of glm as an R object; apply the broom::tidy to this object; and obtain the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing black victims to white victims keeping all other variables fixed.

``` r
fit_logistic_Baltimore = 
  filter(data_p1_city, city_state == 'Baltimore, MD') %>% 
  glm(solved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

CI_Baltimore = 
  confint(fit_logistic_Baltimore) %>% 
  broom::tidy(.) %>% 
  rename(., term = .rownames, CI_low = X2.5.., CI_high = X97.5..)
```

    ## Waiting for profiling to be done...

    ## Warning: 'tidy.matrix' is deprecated.
    ## See help("Deprecated")

``` r
fit_logistic_Baltimore %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         CI_low = estimate - std.error*qt(0.975, 2820),
         CI_high = estimate + std.error*qt(0.975, 2820),
         exp_CI_low = exp(CI_low),
         exp_CI_high = exp(CI_high)) %>%
  select(term, OR, exp_CI_low, exp_CI_high) %>%
  filter(., term == 'victim_raceBlack') %>% 
  knitr::kable(digits = 3)
```

| term              |     OR|  exp\_CI\_low|  exp\_CI\_high|
|:------------------|------:|-------------:|--------------:|
| victim\_raceBlack |  0.431|         0.306|          0.607|
